---
layout: post
title: "用Python下载上市公司定期报告"
date: 2020-04-20 14:23:56 +0800
categories: Python, Fintech
---

{% include header.html %}

# 一、前言：

本文是用 Python 获取企业年报数据并进行企业价值分析系列文章的第一篇，主要讲述如何用 Python 从巨潮网站下载相应的企业定期报告。

# 二、知识点:

- 了解 Python 的基本语法，了解类的概念
- 掌握爬虫库 selenium 基本用法
- 安装了 Python 运行开发环境，如 Anaconda

# 三、准备工作：

<big>1.上市公司价值分析之 DCF 模型</big>

对上市公司的价值分析主要是通过折现现金流模型 DCF（Discounted Cashflow Model），该模型的主要计算方法是将企业未来所产生的现金流量折算为当前时点的现值，即为企业的内在价值。

$$P=\sum_{t=1}^n\frac{CF_t}{(1+r)^t}$$

- $P$：企业的价值
- $CF_t$: 企业在 $t$ 时刻产生的现金流
- $r$：预期现金流的折现率
- $n$：企业的续存期

<big>2.关于巨潮资讯 cninfo</big>

[巨潮资讯网](http://www.cninfo.com.cn) 是证监会指定的深圳上市公司法定信息披露网站，其实不论沪市还是深市的上市公司的定期报告、公告都可以在这里查到，以 PDF 格式为主。

_备注：似乎从 2019 年开始，巨潮资讯网改版后本来可以直接通过上市公司代码下载对应的公告的功能，现在还需要找到上市公司对应的 orgId 后才能下载。而这个 orgId 本身没有什么规律可言，所以每次都需要人工打开网站进行查询，获取 orgId。_

<big>3.下载数据范围</big>

要计算企业的内在价值，就需要通过企业的三张表（资产负债表、利润表、现金流量表以及现金流量表补充资料）提取相应的财务数据进行计算，因此需要下载企业的一季报、半年报、三季报和年报。

<big>4.关于 Python 开发环境</big>

Python 语言本身就不用多说，近年来随着大数据人工智能的兴起，越来越火，语言语法本身除了没有大括号和分号，采用退格缩进来进行语句块的划分比较另类外，基本属于 C-Java-C#-Javascript 这类 C 系列的影子，所以有上述语言基础的学习起来相当顺手。

Anaconda 作为 Python 语言的综合开发环境可谓功能强大不但免费量又足，JupterLab 现在也支持暗黑模式了，作为首选开发环境就可以了。当然，作为程序员，对显示字体的要求可谓苛刻，Source Code Pro 当仁不让。这些都可以通过系统的设置进行修改：

```json
{
  "codeCellConfig": {
    "lineNumbers": true,
    "fontFamily": "Source Code Pro Light",
    "lineHeight": 1.8
  }
}
```

# 四、程序及结构：

<big>1. 流程说明</big>

财务报表下载流程逻辑本身很简单：

1. 确定要下载的报表的上市公司，获取对应的代码，如：中国国旅对应的是 601888
2. 打开[巨潮资讯网](http://www.cninfo.com.cn) ,在最上方的搜索框输入代码，转到对应的查询页面，获取 orgId：

```
http://www.cninfo.com.cn/new/disclosure/stock?orgId=9900008313&stockCode=601888
```

3. 确认下载目录和报告存放目录后，运行下载程序
4. 下载程序会模拟人点击，仅下载上市公司的一季报、半年报、三季报、年报。
5. PDF 文件下载后进行重命名，名称包括了年份以及报告季度，便于后续程序识别。
6. 如果有多页，则按顺序翻页，下载全部所需报告
7. 下载完成后，将 PDF 文件移动到存放目录以备后续报表数据识别清洗程序使用
