---
layout: post
title: 用Python对上市公司做价值分析：（四）企业价值分析
date: 2019-11-26 19:53:35 +0800
categories: [Python, Fintech, SQL Server]
tag: [Python, Fintech, Pandas]
---

{% include header.html %}

# 一、前言：

本文是用 Python 获取企业年报数据并进行企业价值分析系列文章的第四篇，通过对企业历年（一般设定为 5 年）的资产负债表、利润表、现金流量表以及现金流量表补充资料的数据提取，通过折现现金流模型（DCF）计算企业的价值，作为对投资的指导指标。

![股票Beta值计算](/assets/images/beta.png)

# 二、知识点:

- 掌握相关库 pandas, plotly, sklearn, sqlalchemy 的相关用法
- 掌握基本的统计学相关概念，线性回归
- 了解财务分析的三张表的内容以及标准会计科目
- SQL 数据库结构化查询语言的掌握
- 掌握 DCF 模型中相关变量的计算

<!--more-->

# 三、DCF 模型解析：

通过 DCF 模型计算企业内在价值是最符合价值投资理论的方法，可以通过对企业财务报表的数据分析获得相对客观的企业价值。

$$P=\sum_{t=1}^n\frac{CF_t}{(1+r)^t}$$

- $P$：企业的价值
- $CF_t$: 企业在 $t$ 时刻产生的现金流
- $r$：预期现金流的折现率
- $n$：企业的续存期

由于 DCF 模型建立在欧美财务报表的基础上，由于财税准则等方面的差异，在用中国上市公司的财务报表相关科目对其计算的过程中，难免会有一些不够直观的地方，需要额外计算才可得出。

DCF 的一般形式为：

$$ 公司价值 = \sum_{t=1}^n\frac{FCFF_t}{(1+WACC)^t} + \frac{FCFF_{n+1}/(WACC_n - g_n)}{(1 + WACC)^n} $$

<big>1.自由现金流 FCFF 的计算公式分解</big>

FCFF（Free Cash Flow for the Firm）：企业产生的，在满足了再投资需求之后剩余的、不影响公司持续发展的前提下、可供企业资本提供者和各种利益要求人（股东、债权人）分配的现金。

FCFF = (税后净利润 + 利息费用 + 非现金支出) - 营运资本追加 - 资本性支出
FCFF = (1-税率 t) x 息税前利润 EBIT + 折旧 - 资本性支出 CAPX - 净营运资金 NWC 的变化

根据 FCFF 的计算公式，下面就分别求出各个变量值

- 企业税率 t：
  根据财务报表计算过去 5 年的企业平均税率:

$$ t = \frac{税收:（会计科目：所得税或所得税费用(133)）} {税前收入: （会计科目：利润总额(103)）} $$

- 息税前利润 EBIT：会计科目：利润总额(103)

- 折旧：会计科目：固定资产折旧、油气资产折耗、生产性生物资产折旧(447)

- 资本性支出 CAPX：
  资本性支出在 A 股上市公司的财务报表中没有直接对应科目，需要进行计算得出，而且中国股市重融资的传统，会不断有定向增发这类操作，对其计算也产生一定影响。

  - 标准公式：
    资本性支出(CAPX) = 会计科目：购建固定、无形、其他长期资产所支付的现金(250) — 会计科目：处置固定、无形、其他长期资产而收回的现金净额(246)

  - 有定向增发的公式变形：
    资本性支出(CAPX) == 期末固定资产净额 - 期初固定资产净额 + 在建工程净增加值 - 资本公积净增加值(356) + 折旧(447)
    其中：资本公积净增加值 == max(0, 期末资本公积 - 期初资本公积)
    在建工程净增加值 == max(0, 期末在建工程净额 - 期初在建工程净额)

- 净营运资本（NWC）的变化：

  - 营运资本 即为 会计科目: 流动资产(367)
  - 净营运资本(NWC: Net Working Capital) = 净流动资产的变化 = 流动资产(367)-流动负债(368)
  - 净营运资本的变化 = 本期 NWC - 上期 NWC

<big>2.其他相关财务指标</big>

- 收入增长率：

  $$ 收入增长率 = 营业收入增长率 = \frac{(本期营业收入总额-上期营业收入总额)}{上年营业收入总额(100)} $$

- 净营运利润率 NOP：

  营运利润一般指息税前收入 EBIT,即营业利润 ITEM_ID: 102
  $$ 营运利润率= \frac{营运利润(102)}{营业总收入(100)} $$

- 固定资本投资

  $$ 固定资本投资 = \frac{净资本投资(250)}{营业总收入(100)} $$

  $$ 新增固定投资百分比 = \frac{净资本投资(250)}{营业总收入(100)} $$

- 折旧百分比

  $$ 折旧百分比 = \frac{固定资产折旧、油气资产折耗、生产性生物资产折旧(447)}{营业总收入(100)} $$

- 营运资本占总收入比例

  $$ 营运资本占总收入比 = \frac{应收账款(281) + 存货(290) - 应付账款(322)}{营业总收入(100)} $$

  $$ 营运资本的增加比率 = \frac{营运资本的增加}{总收入(100)} $$

<big>3.WACC 的计算</big>

<big>2.财务报表会计科目值的提取</big>

根据对 FCFF 的计算公式的变量分解，可以得出需要提取的财务报表相关会计科目为：

| 序号 | ITEM_ID | ITEM_NAME                                        |
| ---- | ------- | ------------------------------------------------ |
| 0    | 100     | 营业总收入                                       |
| 1    | 101     | 营业总成本                                       |
| 2    | 102     | 营业利润                                         |
| 3    | 103     | 利润总额                                         |
| 4    | 104     | 净利润                                           |
| 5    | 133     | 减所得税费用                                     |
| 6    | 217     | 现金及现金等价物净增加额                         |
| 7    | 246     | 处置固定资产无形资产和其他长期资产收回的现金净额 |
| 8    | 250     | 购建固定资产无形资产和其他长期资产支付的现金     |
| 9    | 281     | 应收账款                                         |
| 10   | 290     | 存货                                             |
| 11   | 301     | 固定资产                                         |
| 12   | 302     | 在建工程                                         |
| 13   | 322     | 应付账款                                         |
| 14   | 356     | 资本公积                                         |
| 15   | 367     | 流动资产合计                                     |
| 16   | 368     | 流动负债合计                                     |
| 17   | 445     | 净利润                                           |
| 18   | 447     | 固定资产折旧油气资产折耗生产性生物资产折旧       |
| 19   | 469     | 现金及现金等价物净增加额                         |

<big>3.程序流程</big>
